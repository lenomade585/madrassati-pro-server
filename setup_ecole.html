<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Super Admin - Cr√©ation √âcoles</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .container { background: white; padding: 20px; border-radius: 8px; max-width: 500px; margin: 0 auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; cursor: pointer; font-size: 16px; }
        button:hover { background: #218838; }
        .list { margin-top: 30px; }
        .school-item { background: #e9ecef; padding: 10px; margin-bottom: 5px; border-left: 5px solid #007bff; }
    </style>
</head>
<body>

<div class="container">
    <h2>üè´ Ajouter une Nouvelle √âcole</h2>
    <input type="text" id="nom" placeholder="Nom de l'√©cole (ex: √âcole El-Amel)">
    <input type="text" id="ville" placeholder="Ville (ex: Alger)">
    <input type="text" id="password" placeholder="Mot de passe Admin (ex: 1234)">
    <button onclick="creerEcole()">Enregistrer l'√âcole</button>

    <div class="list">
        <h3>Liste des √âcoles existantes :</h3>
        <div id="listeEcoles">Chargement...</div>
    </div>
</div>

<script>
    // --- CORRECTION MAJEURE : URL DE L'API ---
    // üõë REMPLACEZ L'URL SUIVANTE PAR CELLE QUE RENDER VOUS DONNERA APR√àS D√âPLOIEMENT
    const API_BASE_URL = "https://madrassati-pro-server.onrender.com";
    // Si vous travaillez en local avec le serveur Node.js, vous pouvez d√©commenter la ligne ci-dessous :
    // const API_BASE_URL = "http://localhost:3000"; 
    // ----------------------------------------------------------------------------------

    // 1. Fonction pour CR√âER une √©cole
    async function creerEcole() {
        const nom = document.getElementById('nom').value;
        const ville = document.getElementById('ville').value;
        const password = document.getElementById('password').value;

        if(!nom || !ville) return alert("Remplissez tout !");

        try {
            // CORRIG√â : Utilisation de API_BASE_URL
            const response = await fetch(`${API_BASE_URL}/api/create-school`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: nom, city: ville, password: password })
            });
    
            const data = await response.json();
            alert(data.message);
            chargerEcoles(); // On rafra√Æchit la liste

        } catch (error) {
            console.error("Erreur cr√©ation √©cole:", error);
            alert("Erreur de connexion au serveur API.");
        }
    }

    // 2. Fonction pour VOIR les √©coles
    async function chargerEcoles() {
        const divListe = document.getElementById('listeEcoles');
        divListe.innerHTML = 'Chargement...';

        try {
            // CORRIG√â : Utilisation de API_BASE_URL
            const response = await fetch(`${API_BASE_URL}/api/schools`);
            const data = await response.json();
            
            divListe.innerHTML = '';

            // NOTE : Il faut s'assurer que la route /api/schools dans server.js 
            // renvoie un objet JSON avec une propri√©t√© 'schools' qui est un tableau.
            const schools = data.schools || data; 

            if (schools.length === 0) {
                 divListe.innerHTML = 'Aucune √©cole enregistr√©e.';
                 return;
            }

            schools.forEach(ecole => {
                divListe.innerHTML += `
                    <div class="school-item">
                        <strong>ID ${ecole.id} : ${ecole.name}</strong><br>
                        üìç ${ecole.city} 
                        (Admin Pass: ${ecole.admin_password || 'Non affich√©'})
                    </div>
                `;
            });
        } catch (error) {
             console.error("Erreur chargement √©coles:", error);
             divListe.innerHTML = '‚ùå Erreur de connexion au serveur API.';
        }
    }

    // Charger la liste au d√©marrage
    chargerEcoles();
</script>

</body>
</html>