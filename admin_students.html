<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            background-color: #f4f6f9; 
            padding: 20px; 
            font-family: 'Cairo', sans-serif; 
            text-align: right;
        }
        .container { max-width: 800px; margin-top: 20px; }
        
        .card { 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            border: none; 
            padding: 25px; 
            margin-bottom: 20px;
        }
        
        /* Bouton Retour */
        .btn-back {
            background-color: #6c757d; color: white; text-decoration: none;
            padding: 8px 15px; border-radius: 8px; font-size: 0.9em;
            display: inline-block; margin-bottom: 15px;
        }
        .btn-back:hover { background-color: #5a6268; color: white; }

        h3 { color: #007bff; font-weight: 700; margin-bottom: 20px; }
        
        /* Zone d'import Excel */
        .import-box {
            background-color: #e3f2fd;
            border: 2px dashed #90caf9;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        /* Table des Ã©lÃ¨ves */
        .table-custom {
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        .table-custom thead {
            background-color: #007bff;
            color: white;
        }
        .table-custom th, .table-custom td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .code-badge {
            background-color: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 1.1em;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <a href="admin_dashboard.html" class="btn-back">ğŸ  Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Retour)</a>

        <div class="card">
            <h3>ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° (Excel)</h3>
            <p class="text-muted mb-3">ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ù…Ù„Ù Excel Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ Ø¨Ø§Ø³Ù… "Nom" (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨)</p>
            
            <div class="import-box">
                <input type="file" id="excelFile" class="form-control mb-3" accept=".xlsx, .xls">
                <button onclick="uploadFile()" class="btn btn-primary fw-bold">ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</button>
            </div>
        </div>

        <div class="card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="m-0">ğŸ‘¨â€ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h3>
                <span class="badge bg-secondary fs-6" id="studentCount">0 ØªÙ„Ù…ÙŠØ°</span>
            </div>

            <div class="table-responsive">
                <table class="table table-custom">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨ (Nom PrÃ©nom)</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Matricule)</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTable">
                        <tr><td colspan="3" class="text-center">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- CORRECTION MAJEURE : URL DE L'API ---
        // ğŸ›‘ REMPLACEZ L'URL SUIVANTE PAR CELLE QUE RENDER VOUS DONNERA APRÃˆS DÃ‰PLOIEMENT
        const API_BASE_URL = "https://VOTRE-URL-PUBLIQUE-DE-RENDER-ICI.com";
        // Si vous travaillez en local avec le serveur Node.js, vous pouvez dÃ©commenter la ligne ci-dessous :
        // const API_BASE_URL = "http://localhost:3000"; 
        // ----------------------------------------------------------------------------------

        // --- 1. CHARGEMENT DE LA LISTE ---
        window.onload = loadStudents;

        async function loadStudents() {
            try {
                // CORRIGÃ‰ : Utilisation de API_BASE_URL
                const res = await fetch(`${API_BASE_URL}/api/students`);
                const students = await res.json();
                
                const tbody = document.getElementById('studentsTable');
                document.getElementById('studentCount').innerText = students.length + " ØªÙ„Ù…ÙŠØ°";
                tbody.innerHTML = '';

                if (students.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" class="text-center p-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ„Ø§Ù…ÙŠØ° Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>';
                    return;
                }

                students.forEach((s, index) => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td class="fw-bold text-primary">${s.name}</td>
                            <td><span class="code-badge">${s.code}</span></td>
                        </tr>
                    `;
                });

            } catch (error) {
                console.error("Erreur:", error);
                document.getElementById('studentsTable').innerHTML = '<tr><td colspan="3" class="text-center text-danger">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</td></tr>';
            }
        }

        // --- 2. FONCTION D'IMPORT EXCEL ---
        async function uploadFile() {
            const fileInput = document.getElementById('excelFile');
            const file = fileInput.files[0];

            if (!file) return alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel Ø£ÙˆÙ„Ø§Ù‹ !");

            const formData = new FormData();
            formData.append('file', file);

            try {
                // On affiche un petit message d'attente
                const btn = document.querySelector('button[onclick="uploadFile()"]');
                const originalText = btn.innerText;
                btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";
                btn.disabled = true;

                // CORRIGÃ‰ : Utilisation de API_BASE_URL
                const response = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert("âœ… " + result.message);
                    fileInput.value = ''; // Vider l'input
                    loadStudents(); // Recharger la liste immÃ©diatement
                } else {
                    alert("âŒ Ø®Ø·Ø£: " + result.message);
                }

                // On remet le bouton normal
                btn.innerText = originalText;
                btn.disabled = false;

            } catch (error) {
                console.error("Erreur upload:", error);
                alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
            }
        }
    </script>
</body>
</html>