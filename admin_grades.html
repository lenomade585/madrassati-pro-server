<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            background-color: #f4f6f9; 
            padding: 20px; 
            font-family: 'Cairo', sans-serif; 
            text-align: right;
        }
        .container { max-width: 600px; margin-top: 20px; }
        .card { 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            border: none; 
            padding: 25px; 
        }
        
        .btn-back {
            background-color: #6c757d; color: white; text-decoration: none;
            padding: 8px 15px; border-radius: 8px; font-size: 0.9em;
            display: inline-block; margin-bottom: 15px;
        }
        .btn-back:hover { background-color: #5a6268; color: white; }

        h3 { color: #28a745; font-weight: 700; margin-bottom: 20px; } /* Vert pour les notes */
        label { font-weight: 600; color: #555; margin-bottom: 5px; }
        
        .form-select, .form-control {
            padding: 12px; border-radius: 10px; margin-bottom: 20px;
        }

        .btn-submit {
            background-color: #28a745; color: white; font-weight: bold;
            padding: 15px; border-radius: 10px; border: none; width: 100%;
            font-size: 1.1em; transition: 0.3s;
        }
        .btn-submit:hover { background-color: #218838; }
    </style>
</head>
<body>

    <div class="container">
        <a href="admin_dashboard.html" class="btn-back">ğŸ  Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Retour)</a>

        <div class="card shadow">
            <h3 class="text-center">ğŸ“ Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ´Ù Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
            <p class="text-center text-muted">Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªÙ„Ù…ÙŠØ°</p>

            <label>Ø§Ù„ØªÙ„Ù…ÙŠØ° (Ã‰lÃ¨ve)</label>
            <select class="form-select" id="studentSelect">
                <option selected disabled>...Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>
            </select>

            <label>Ø§Ù„Ù…Ø§Ø¯Ø© (MatiÃ¨re)</label>
            <select class="form-select" id="subjectInput">
                <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">ğŸ“ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª (Maths)</option>
                <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">ğŸ“– Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabe)</option>
                <option value="Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡">âš¡ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ (Physique)</option>
                <option value="Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©">ğŸŒ¿ Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© (Sciences)</option>
                <option value="Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©">ğŸ‡«ğŸ‡· Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© (FranÃ§ais)</option>
                <option value="Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">ğŸ‡¬ğŸ‡§ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (Anglais)</option>
                <option value="Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§">ğŸŒ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§ (Histoire-GÃ©o)</option>
                <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">ğŸ•Œ Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© (Islamique)</option>
            </select>

            <label>Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (Note /20)</label>
            <input type="number" class="form-control" id="scoreInput" placeholder="Ù…Ø«Ø§Ù„: 15.5" step="0.5" min="0" max="20">

            <button onclick="submitGrade()" class="btn btn-submit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (Enregistrer)</button>
        </div>
    </div>

    <script>
        // --- CORRECTION MAJEURE : URL DE L'API ---
        // ğŸ›‘ REMPLACEZ L'URL SUIVANTE PAR CELLE QUE RENDER VOUS DONNERA APRÃˆS DÃ‰PLOIEMENT
        const API_BASE_URL = "https://VOTRE-URL-PUBLIQUE-DE-RENDER-ICI.com";
        // Si vous travaillez en local avec le serveur Node.js, vous pouvez dÃ©commenter la ligne ci-dessous :
        // const API_BASE_URL = "http://localhost:3000"; 
        // ----------------------------------------------------------------------------------

        // Chargement liste Ã©lÃ¨ves
        window.onload = async function() {
            try {
                // CORRIGÃ‰ : Utilisation de API_BASE_URL
                const res = await fetch(`${API_BASE_URL}/api/students`);
                const students = await res.json();
                const select = document.getElementById('studentSelect');
                
                select.innerHTML = '<option selected disabled>-- Ø§Ø®ØªØ± Ø§Ù„ØªÙ„Ù…ÙŠØ° --</option>';
                if (students.length > 0) {
                    students.forEach(s => {
                        // On stocke le code de l'Ã©lÃ¨ve (s.code) comme valeur pour le back-end
                        select.innerHTML += `<option value="${s.code}">${s.name} (${s.code})</option>`;
                    });
                }
            } catch (error) {
                console.error("Erreur:", error);
                alert("Erreur connexion serveur lors du chargement des Ã©lÃ¨ves.");
            }
        };

        // Envoi de la note
        async function submitGrade() {
            const studentCode = document.getElementById('studentSelect').value;
            const subject = document.getElementById('subjectInput').value;
            const score = document.getElementById('scoreInput').value;

            if (!studentCode || studentCode.includes('Ø§Ø®ØªØ±')) return alert("âš ï¸ Ø§Ø®ØªØ± Ø§Ù„ØªÙ„Ù…ÙŠØ° Ø£ÙˆÙ„Ø§Ù‹");
            if (!score) return alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù„Ø§Ù…Ø©");
            if (score < 0 || score > 20) return alert("âš ï¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0 Ùˆ 20");

            try {
                // CORRIGÃ‰ : Utilisation de API_BASE_URL
                const response = await fetch(`${API_BASE_URL}/api/grades`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        student_id: studentCode, 
                        subject: subject, 
                        score: parseFloat(score) // S'assurer que le score est un nombre
                    })
                });

                if (response.ok) {
                    alert(`âœ… ØªÙ… Ø­ÙØ¸ Ø¹Ù„Ø§Ù…Ø© ${subject} Ø¨Ù†Ø¬Ø§Ø­ !`);
                    document.getElementById('scoreInput').value = ''; // Vider juste la note pour enchainer
                } else {
                    alert("âŒ Erreur serveur");
                }
            } catch (error) {
                alert("âŒ Erreur connexion");
            }
        }
    </script>
</body>
</html>